<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>blob - Celestia App Specifications</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">Celestia App Specifications</a></li><li class="chapter-item expanded "><a href="../../specs/index.html"><strong aria-hidden="true">1.</strong> Specification</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../specs/data_structures.html"><strong aria-hidden="true">1.1.</strong> Data Structures</a></li><li class="chapter-item expanded "><a href="../../specs/shares.html"><strong aria-hidden="true">1.2.</strong> Shares</a></li><li class="chapter-item expanded "><a href="../../specs/consensus.html"><strong aria-hidden="true">1.3.</strong> Consensus</a></li><li class="chapter-item expanded "><a href="../../specs/block_proposer.html"><strong aria-hidden="true">1.4.</strong> Block Proposer</a></li><li class="chapter-item expanded "><a href="../../specs/block_validity_rules.html"><strong aria-hidden="true">1.5.</strong> Block Validity Rules</a></li><li class="chapter-item expanded "><a href="../../specs/networking.html"><strong aria-hidden="true">1.6.</strong> Networking</a></li><li class="chapter-item expanded "><a href="../../specs/public_key_cryptography.html"><strong aria-hidden="true">1.7.</strong> Public-Key Cryptography</a></li></ol></li><li class="chapter-item expanded "><a href="../../rationale/index.html"><strong aria-hidden="true">2.</strong> Rationale</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../rationale/data_square_layout.html"><strong aria-hidden="true">2.1.</strong> Data Square Layout</a></li></ol></li><li class="chapter-item expanded "><a href="../../specs/state_machine_modules.html"><strong aria-hidden="true">3.</strong> State Machine Modules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../x/blob/index.html" class="active"><strong aria-hidden="true">3.1.</strong> blob</a></li><li class="chapter-item expanded "><a href="../../../../x/qgb/index.html"><strong aria-hidden="true">3.2.</strong> qgb</a></li><li class="chapter-item expanded "><a href="../../../../x/mint/index.html"><strong aria-hidden="true">3.3.</strong> mint</a></li><li class="chapter-item expanded "><a href="../../../../x/paramfilter/index.html"><strong aria-hidden="true">3.4.</strong> paramfilter</a></li><li class="chapter-item expanded "><a href="../../../../x/upgrade/index.html"><strong aria-hidden="true">3.5.</strong> upgrade</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Celestia App Specifications</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/celestiaorg/celestia-app" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="xblob"><a class="header" href="#xblob"><code>x/blob</code></a></h1>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>The <code>x/blob</code> module enables users to pay for arbitrary data to be published to the Celestia blockchain. Users create a single <code>BlobTx</code> that is composed of:</p>
<ol>
<li>Multiple <code>Blob</code>s (Binary Large OBjects): the data they wish to publish. A single <code>Blob</code> is composed of:
<ol>
<li><code>NamespaceId  []byte</code>: the namespace this blob should be published to.</li>
<li><code>Data         []byte</code>: the data to be published.</li>
<li><code>ShareVersion uint32</code>: the version of the share format used to encode this blob into a share.</li>
</ol>
</li>
<li>A single <code>sdk.Tx</code> which is composed of:
<ol>
<li><code>Signer string</code>: the transaction signer</li>
<li><code>NamespaceIds []byte</code>: the namespaces they wish to publish each blob to. The namespaces here must match the namespaces in the <code>Blob</code>s.</li>
<li><code>ShareCommitment []byte</code>: a share commitment that is the root of a Merkle tree where the leaves are share commitments to each blob associated with this BlobTx.</li>
</ol>
</li>
</ol>
<p>After the <code>BlobTx</code> is submitted to the network, a block producer separates the transaction from the blob. Both components get included in the data square in different namespaces: the BlobTx gets included in the PayForBlobNamespace and the associated blob gets included in the namespace the user specified in the original <code>BlobTx</code>. Further reading: <a href="https://github.com/celestiaorg/celestia-specs/blob/master/src/rationale/message_block_layout.md">Message Block Layout</a></p>
<p>After a block has been created, the user can verify that their data was included in a block via a blob inclusion proof. A blob inclusion proof uses the <code>ShareCommitment</code> in the original transaction and subtree roots of the block's data square to prove to the user that the shares that compose their original data do in fact exist in a particular block.</p>
<h2 id="state"><a class="header" href="#state">State</a></h2>
<p>The blob module doesn't maintain it's own state.</p>
<p>When a <code>MsgPayForBlob</code> is processed, it consumes gas based on the blob size.</p>
<h2 id="messages"><a class="header" href="#messages">Messages</a></h2>
<ul>
<li><a href="https://github.com/celestiaorg/celestia-app/blob/8b9c4c9d13fe0ccb6ea936cc26dee3f52b6f6129/proto/blob/tx.proto#L39-L44"><code>MsgPayForBlob</code></a> pays for the blob to be included in the block.</li>
</ul>
<h2 id="prepareproposal"><a class="header" href="#prepareproposal">PrepareProposal</a></h2>
<p>When a block producer is preparing a block, they must perform an extra step for <code>BlobTx</code>s so that end-users can find the blob shares relevant to their submitted <code>BlobTx</code>. In particular, block proposers wrap the <code>BlobTx</code> in the PayForBlobs namespace with the index of the first share of the blob in the data square. See <a href="https://github.com/celestiaorg/celestia-specs/blob/master/src/rationale/message_block_layout.md#non-interactive-default-rules">Non-interactive Default Rules</a> for more details.</p>
<p>Since <code>BlobTx</code>s can contain multiple blobs, the <code>BlobTx</code> is wrapped with one share index per blob in the transaction. The index wrapped transaction is called an <a href="https://github.com/celestiaorg/celestia-core/blob/2d2a65f59eabf1993804168414b86d758f30c383/proto/tendermint/types/types.proto#L192-L198">IndexWrapper</a> and this is the type that gets marshalled and written to the PayForBlobNamespace.</p>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<p>The blob module emits the following events:</p>
<h3 id="blob-events"><a class="header" href="#blob-events">Blob Events</a></h3>
<h4 id="eventpayforblob"><a class="header" href="#eventpayforblob">EventPayForBlob</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Attribute Key</th><th>Attribute Value</th></tr></thead><tbody>
<tr><td>signer</td><td>{bech32 encoded signer address}</td></tr>
<tr><td>blob_size</td><td>{size in bytes}</td></tr>
<tr><td>namespace_ids</td><td>{namespaces the blobs should be published to}</td></tr>
</tbody></table>
</div>
<h2 id="parameters"><a class="header" href="#parameters">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Type</th><th>Default</th></tr></thead><tbody>
<tr><td>GasPerBlobByte</td><td>uint32</td><td>8</td></tr>
</tbody></table>
</div>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<pre><code class="language-shell">celestia-app tx blob PayForBlobs &lt;hex encoded namespace&gt; &lt;hex encoded data&gt; [flags]
</code></pre>
<p>For submitting PFB transaction via a light client's rpc, see <a href="https://docs.celestia.org/developers/rpc-tutorial/#submitpayforblob-arguments">celestia-node's documention</a>.</p>
<p>While not directly supported, the steps in the <a href="https://github.com/celestiaorg/celestia-app/blob/a82110a281bf9ee95a9bf9f0492e5d091371ff0b/x/blob/payforblob.go"><code>SubmitPayForBlob</code></a> function can be reverse engineered to submit blobs programmatically.</p>
<!-- markdownlint-enable MD010 -->
<h3 id="how-is-the-sharecommitment-of-a-blob-generated"><a class="header" href="#how-is-the-sharecommitment-of-a-blob-generated">How is the <code>ShareCommitment</code> of a blob generated?</a></h3>
<p>See <a href="https://github.com/celestiaorg/celestia-app/blob/ead76d2bb607ac8a2deaba552de86d4df74a116b/x/blob/types/payforblob.go#L133"><code>CreateCommitment</code></a>.</p>
<ol>
<li>Split the blob into shares of size <code>appconsts.ShareSize</code></li>
<li>Determine the <code>BlobMinSquareSize</code> (the minimum square size the blob can fit into). This is done by taking the number of shares from the previous step and rounding up to the next perfect square that is a power of two.</li>
<li>Arrange the shares into a Merkle mountain range where each tree in the mountain range has a maximum size of the <code>BlobMinSquareSize</code>. Note: each share is prefixed with a duplicate copy of the namespace so that the roots in the next step match up with the subtree roots of the NMT of the data square.</li>
<li>Take the roots of the trees in the Merkle mountain range and create a new Merkle tree.</li>
<li>The share commitment of this blob is the Merkle root of the Merkle tree from the previous step.</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../specs/state_machine_modules.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../../x/qgb/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../specs/state_machine_modules.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../../x/qgb/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
